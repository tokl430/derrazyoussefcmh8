<!DOCTYPE html>
<!-- saved from url=(0051)file:///C:/Users/y.derraz/Downloads/new%202000.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Email Header Cleaner (Final v14)</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 30px;
      color: #333;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.15);
      padding: 25px;
    }
    h2 { text-align: center; color: #6f42c1; margin-bottom: 20px; }
    label { font-weight: 600; color: #495057; }
    textarea {
      width: 100%; height: 200px; margin-top: 8px; padding: 12px;
      border: 2px solid #6f42c1; border-radius: 10px;
      font-size: 13px; background: #fdfdfd; resize: vertical;
      white-space: pre-wrap; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      font-family: monospace;
    }
    .buttons { margin-top: 18px; text-align: center; }
    .btn {
      padding: 12px 24px; margin: 8px; border: none; border-radius: 25px;
      font-size: 14px; cursor: pointer; color: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .import-btn { background: #6f42c1; }
    .clean-btn  { background: #28a745; }
    .export-btn { background: #fd7e14; }
    .clear-btn  { background: #17a2b8; }
    .deselect-btn { background: #dc3545; }
    .apply-btn { background: #007bff; }
    .insert-btn { background: #ff5722; }
    .headers-box {
      margin: 20px 0; padding: 15px; border-radius: 10px;
      background: #f8f9fa; border: 1px solid #dee2e6; max-height: 200px; overflow-y: auto;
    }
    .headers-box label { display: inline-block; margin-right: 15px; margin-bottom: 8px; }
    .options { margin: 20px 0; }
    .options textarea {
      width: 90%; height: 120px; padding: 10px;
      border: 2px solid #6f42c1; border-radius: 10px; resize: vertical;
      font-family: monospace;
    }
  </style>
</head>
<body>

<div class="container">
 <hi class="padding:30px;color:black;font-size:13px;">YOUSSEF DERRAZ CMH8</hi>
  <h2>  NEWSLITTER Cleaner </h2>
 
  <label for="input">Paste NEWSLITTER:</label>
  <textarea id="input" placeholder="Paste header here..."></textarea>

  <input id="fileInput" type="file" accept=".txt,.eml,text/*" style="display:none">

  <div class="buttons">
    <button class="btn import-btn" id="importBtn"> Import</button>
    <button class="btn clean-btn" id="cleanBtn"> Clean</button>
    <button class="btn export-btn" id="exportBtn"> Export</button>
    <button class="btn clear-btn" id="clearBtn"> Clear</button>
    <button class="btn deselect-btn" id="deselectBtn"> Deselect All</button>
  </div>

  <h3>Choose PARAMS to remove:</h3>
  <div id="headersBox" class="headers-box"><label><input type="checkbox" id="chk__size" data-header="-size" checked=""> -size</label><label><input type="checkbox" id="chk__table_rspace" data-header="-table-rspace" checked=""> -table-rspace</label><label><input type="checkbox" id="chk__text_size_adjust" data-header="-text-size-adjust" checked=""> -text-size-adjust</label><label><input type="checkbox" id="chk_ARC_Authentication_Results" data-header="ARC-Authentication-Results" checked=""> ARC-Authentication-Results</label><label><input type="checkbox" id="chk_ARC_Message_Signature" data-header="ARC-Message-Signature" checked=""> ARC-Message-Signature</label><label><input type="checkbox" id="chk_ARC_Seal" data-header="ARC-Seal" checked=""> ARC-Seal</label><label><input type="checkbox" id="chk_Authentication_Results" data-header="Authentication-Results" checked=""> Authentication-Results</label><label><input type="checkbox" id="chk_Content_Transfer_Encoding" data-header="Content-Transfer-Encoding" checked=""> Content-Transfer-Encoding</label><label><input type="checkbox" id="chk_Content_Type" data-header="Content-Type" checked=""> Content-Type</label><label><input type="checkbox" id="chk_DKIM_Signature" data-header="DKIM-Signature" checked=""> DKIM-Signature</label><label><input type="checkbox" id="chk_Date" data-header="Date" checked=""> Date</label><label><input type="checkbox" id="chk_Delivered_To" data-header="Delivered-To" checked=""> Delivered-To</label><label><input type="checkbox" id="chk_From" data-header="From" checked=""> From</label><label><input type="checkbox" id="chk_Message_Id" data-header="Message-Id" checked=""> Message-Id</label><label><input type="checkbox" id="chk_Mime_Version" data-header="Mime-Version" checked=""> Mime-Version</label><label><input type="checkbox" id="chk_Received" data-header="Received" checked=""> Received</label><label><input type="checkbox" id="chk_Received_SPF" data-header="Received-SPF" checked=""> Received-SPF</label><label><input type="checkbox" id="chk_Return_Path" data-header="Return-Path" checked=""> Return-Path</label><label><input type="checkbox" id="chk_Subject" data-header="Subject" checked=""> Subject</label><label><input type="checkbox" id="chk_To" data-header="To" checked=""> To</label><label><input type="checkbox" id="chk_X_Feedback_Id" data-header="X-Feedback-Id" checked=""> X-Feedback-Id</label><label><input type="checkbox" id="chk_X_Google_Smtp_Source" data-header="X-Google-Smtp-Source" checked=""> X-Google-Smtp-Source</label><label><input type="checkbox" id="chk_X_Mailgun_Sending_Ip" data-header="X-Mailgun-Sending-Ip" checked=""> X-Mailgun-Sending-Ip</label><label><input type="checkbox" id="chk_X_Mailgun_Sending_Ip_Pool" data-header="X-Mailgun-Sending-Ip-Pool" checked=""> X-Mailgun-Sending-Ip-Pool</label><label><input type="checkbox" id="chk_X_Mailgun_Sending_Ip_Pool_Name" data-header="X-Mailgun-Sending-Ip-Pool-Name" checked=""> X-Mailgun-Sending-Ip-Pool-Name</label><label><input type="checkbox" id="chk_X_Mailgun_Sid" data-header="X-Mailgun-Sid" checked=""> X-Mailgun-Sid</label><label><input type="checkbox" id="chk_X_Received" data-header="X-Received" checked=""> X-Received</label><label><input type="checkbox" id="chk_able_lspace" data-header="able-lspace" checked=""> able-lspace</label><label><input type="checkbox" id="chk_ble_lspace" data-header="ble-lspace" checked=""> ble-lspace</label><label><input type="checkbox" id="chk_border_radius" data-header="border-radius" checked=""> border-radius</label><label><input type="checkbox" id="chk_cal_align" data-header="cal-align" checked=""> cal-align</label><label><input type="checkbox" id="chk_dding_top" data-header="dding-top" checked=""> dding-top</label><label><input type="checkbox" id="chk_ertical_align" data-header="ertical-align" checked=""> ertical-align</label><label><input type="checkbox" id="chk_ext_decoration" data-header="ext-decoration" checked=""> ext-decoration</label><label><input type="checkbox" id="chk_font_weight" data-header="font-weight" checked=""> font-weight</label><label><input type="checkbox" id="chk_g" data-header="g" checked=""> g</label><label><input type="checkbox" id="chk_gn" data-header="gn" checked=""> gn</label><label><input type="checkbox" id="chk_https" data-header="https" checked=""> https</label><label><input type="checkbox" id="chk_ign" data-header="ign" checked=""> ign</label><label><input type="checkbox" id="chk_t_decoration" data-header="t-decoration" checked=""> t-decoration</label><label><input type="checkbox" id="chk_width" data-header="width" checked=""> width</label></div>

  <div class="options">
    <label>Custom From Name:</label>
    <input type="text" id="customName" placeholder="FROM NAME">

    <div>
      <label><input type="checkbox" id="toggleRdns"> Replace domain with [RDNS]</label><br>
      <label><input type="checkbox" id="toggleRpath"> Replace domain with [P_RPATH]</label><br>
      <label><input type="checkbox" id="toggleEid"> Add [eid] in Message-ID</label><br>
      <label><input type="checkbox" id="toggleIp"> Toggle [ip] before DOCTYPE/HTML/IMG</label><br>
      <label><input type="checkbox" id="toggleHead"> Add &lt;head&gt;&lt;select&gt; above DOCTYPE</label>
    </div>
    <button class="btn apply-btn" id="applyBtn"> Apply</button>
  </div>

  <div class="options">
    <label> Insert HTML:</label><br>
    <textarea id="insertText" placeholder="Enter text to insert above &lt;head&gt;"></textarea><br>
    <button class="btn insert-btn" id="insertBtn"> Insert HTML</button>
  </div>

  <h3>Cleaned STR:</h3>
  <textarea id="output" placeholder="Result will appear here..."></textarea>
</div>

<script>
const fileInput  = document.getElementById('fileInput');
const importBtn  = document.getElementById('importBtn');
const cleanBtn   = document.getElementById('cleanBtn');
const exportBtn  = document.getElementById('exportBtn');
const clearBtn   = document.getElementById('clearBtn');
const deselectBtn= document.getElementById('deselectBtn');
const applyBtn   = document.getElementById('applyBtn');
const insertBtn  = document.getElementById('insertBtn');
const inputArea  = document.getElementById('input');
const outputArea = document.getElementById('output');
const headersBox = document.getElementById('headersBox');
const customNameInput = document.getElementById('customName');
const insertTextInput = document.getElementById('insertText');

importBtn.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', async (evt) => {
  const file = evt.target.files[0];
  if (!file) return;
  inputArea.value = await file.text();
  fileInput.value = '';
  buildHeaderCheckboxes();
});
inputArea.addEventListener('input', buildHeaderCheckboxes);

function buildHeaderCheckboxes() {
  const text = inputArea.value;
  if (!text.trim()) {
    headersBox.innerHTML = "<p style='color:#666'>ðŸ‘‰ Paste or Import a header to see available fields...</p>";
    return;
  }
  const matches = [...text.matchAll(/^([\w\-]+):/gmi)].map(m => m[1]);
  const unique = [...new Set(matches)].sort();
  if (!unique.length) {
    headersBox.innerHTML = "<p style='color:#666'>No headers found.</p>";
    return;
  }

  headersBox.innerHTML = "";
  unique.forEach(h => {
    const id = "chk_" + h.replace(/[^a-z0-9]/gi, "_");
    const label = document.createElement("label");
    label.innerHTML = `<input type="checkbox" id="${id}" data-header="${h}" checked> ${h}`;
    headersBox.appendChild(label);
  });
}

function removeHeaderBlock(text, header) {
  const re = new RegExp("(^" + header + ".*(?:\\r?\\n[ \\t].*)*)", "gmi");
  return text.replace(re, "");
}

function cleanHeader() {
  let text = inputArea.value;
  if (!text.trim()) { alert("Paste or import a header first."); return; }
  const checks = headersBox.querySelectorAll("input[type=checkbox]:checked");
  checks.forEach(chk => { const h = chk.dataset.header; text = removeHeaderBlock(text,h); });
  text = text.replace(/^Received: by[^\n]*(?:\r?\n.*)?/gmi, "");
  text = text.replace(/^X-Received: by[^\n]*(?:\r?\n.*)?/gmi, "");
  text = text.replace(/^\s*[\r\n]/gm, "");
  outputArea.value = text.trim();
}
cleanBtn.addEventListener('click', cleanHeader);

exportBtn.addEventListener('click', () => {
  const text = outputArea.value;
  if (!text.trim()) { alert("Nothing to export."); return; }
  const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "cleaned_header.txt";
  link.click();
});

clearBtn.addEventListener('click', () => {
  inputArea.value = "";
  outputArea.value = "";
  headersBox.innerHTML = "<p style='color:#666'>ðŸ‘‰ Paste or Import a header to see available fields...</p>";
});

deselectBtn.addEventListener('click', () => {
  const checks = headersBox.querySelectorAll("input[type=checkbox]");
  checks.forEach(chk => chk.checked = false);
});

// Apply transformations
function applyTransformations() {
  let text = outputArea.value || inputArea.value;
  if (!text.trim()) { alert("Paste, import, or clean a header first."); return; }

  const custom = customNameInput.value.trim();

  // RDNS
  if (document.getElementById("toggleRdns").checked) {
    text = text.replace(/^From:\s*(?:(.*?)\s*)?<([^@<\s]+)@([^\s>]+)>/gmi, (m, disp, user, domain) => {
      const newDisp = custom || disp || "";
      return `From: ${newDisp ? newDisp + " " : ""}<${user}@[RDNS]>`;
    });
  }

  // RPATH
  if (document.getElementById("toggleRpath").checked) {
    text = text.replace(/^From:\s*(?:(.*?)\s*)?<([^@<\s]+)@([^\s>]+)>/gmi, (m, disp, user, domain) => {
      const newDisp = custom || disp || "";
      return `From: ${newDisp ? newDisp + " " : ""}<${user}@[P_RPATH]>`;
    });
  }

  // Message-ID eid
  if (document.getElementById("toggleEid").checked) {
    text = text.replace(/^Message-ID:\s*<([^@>]+)@([^>]+)>/gmi, "Message-ID: <$1[eid]@$2>");
  }

  // Toggle [ip] -> always in new line
  if (document.getElementById("toggleIp").checked) {
    if (!text.includes("[ip]")) {
      text = text.replace(/(<!DOCTYPE|<html|<img)/i, "\n[ip]\n$1");
    }
  } else {
    text = text.replace(/\s*\[ip\]\s*/gi, "");
  }

  // Add <head><select> -> always in new line
  if (document.getElementById("toggleHead").checked) {
    if (!text.includes("<head><select>")) {
      text = text.replace(/(<!DOCTYPE[^>]*>)/i, "$1\n<head><select>");
    }
  } else {
    text = text.replace(/<head><select>/gi, "");
  }

  outputArea.value = text.trim();
}
applyBtn.addEventListener('click', applyTransformations);

// Insert custom text above <head><select>
insertBtn.addEventListener('click', () => {
  let text = outputArea.value || inputArea.value;
  if (!text.trim()) { alert("Paste, import, or clean a header first."); return; }
  const customText = insertTextInput.value;
  if (!customText.trim()) { alert("Write something first."); return; }

  text = text.replace(/(<head><select>)/i, "\n" + customText + "\n$1");
  outputArea.value = text;
});
</script>



</body></html>
